<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Dashboard de Régularité des Trains | ONCF</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Tableau de bord interactif de la régularité des trains ONCF">

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- DataTables CSS -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- AOS Animation -->
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">

  <style>
    :root {
      --primary-color: #006699;
      --secondary-color: #e9ecef;
      --success-color: #28a745;
      --warning-color: #ffc107;
      --danger-color: #dc3545;
    }
    
    body {
      padding: 20px;
      font-family: 'Segoe UI', 'Roboto', sans-serif;
      background-color: #f8fafc;
      color: #333;
    }

    .logo-container {
      display: flex;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid #eee;
    }

    .header-content {
      margin-left: 20px;
    }

    .logo {
      height: 70px;
      transition: transform 0.3s;
    }

    .logo:hover {
      transform: scale(1.05);
    }

    .header-title {
      color: var(--primary-color);
      margin-bottom: 0;
      font-weight: 700;
    }

    .header-subtitle {
      color: #6c757d;
      margin-top: 5px;
    }

    .section-title {
      font-size: 1.5rem;
      margin-top: 40px;
      margin-bottom: 20px;
      color: var(--primary-color);
      font-weight: 600;
      padding-bottom: 8px;
      border-bottom: 2px solid var(--primary-color);
    }

    .card {
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      margin-bottom: 20px;
      border: none;
      transition: transform 0.3s, box-shadow 0.3s;
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
    }

    .card-header {
      background-color: var(--primary-color);
      color: white;
      font-weight: 600;
      border-radius: 10px 10px 0 0 !important;
    }

    .kpi-card {
      text-align: center;
      padding: 15px;
    }

    .kpi-value {
      font-size: 2.5rem;
      font-weight: 700;
    }

    .kpi-label {
      font-size: 1rem;
      color: #6c757d;
    }

    .positive {
      color: var(--success-color);
    }

    .negative {
      color: var(--danger-color);
    }

    .neutral {
      color: var(--warning-color);
    }

    .table th {
      background-color: var(--secondary-color);
      font-weight: 600;
    }

    .badge-custom {
      padding: 5px 10px;
      border-radius: 20px;
      font-weight: 500;
    }

    .tab-content {
      padding: 20px;
      background: white;
      border: 1px solid #dee2e6;
      border-top: none;
      border-radius: 0 0 10px 10px;
    }

    .nav-tabs .nav-link {
      font-weight: 500;
    }

    .nav-tabs .nav-link.active {
      font-weight: 600;
    }

    .dataTables_filter input {
      border-radius: 20px;
      padding: 5px 15px;
      border: 1px solid #ced4da;
    }

    .progress {
      height: 10px;
      border-radius: 5px;
    }

    .progress-bar {
      background-color: var(--primary-color);
    }

    .chart-container {
      position: relative;
      height: 300px;
      margin-bottom: 30px;
    }

    .last-update {
      font-size: 0.8rem;
      color: #6c757d;
      text-align: right;
      margin-top: 20px;
    }

    @media (max-width: 768px) {
      .logo-container {
        flex-direction: column;
        text-align: center;
      }
      
      .header-content {
        margin-left: 0;
        margin-top: 10px;
      }
      
      .kpi-card {
        margin-bottom: 15px;
      }
    }
  </style>
</head>

<body>

  <!-- En-tête avec logo -->
  <div class="logo-container">
    <img src="LOGO.jpg" alt="Logo ONCF" class="logo">
    <div class="header-content">
      <h1 class="header-title">Dashboard de Régularité des Trains</h1>
      <p class="header-subtitle">Données du <span id="date-jour"></span> <span id="current-time"></span></p>
    </div>
  </div>

  <!-- Section KPI Principaux -->
  <div class="section-title">Indicateurs Clés de Performance</div>
  <div class="row">
    <div class="col-md-3">
      <div class="card kpi-card" data-aos="fade-up">
        <div class="kpi-value positive">92.5%</div>
        <div class="kpi-label">Régularité Globale</div>
        <div class="progress mt-2">
          <div class="progress-bar" role="progressbar" style="width: 92.5%" aria-valuenow="92.5" aria-valuemin="0" aria-valuemax="100"></div>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card kpi-card" data-aos="fade-up" data-aos-delay="100">
        <div class="kpi-value neutral">89.4%</div>
        <div class="kpi-label">Ponctualité Globale</div>
        <div class="progress mt-2">
          <div class="progress-bar" role="progressbar" style="width: 89.4%" aria-valuenow="89.4" aria-valuemin="0" aria-valuemax="100"></div>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card kpi-card" data-aos="fade-up" data-aos-delay="200">
        <div class="kpi-value">36</div>
        <div class="kpi-label">Trains Programmes</div>
        <small class="text-muted">dont 35 circulés</small>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card kpi-card" data-aos="fade-up" data-aos-delay="300">
        <div class="kpi-value negative">4</div>
        <div class="kpi-label">Trains Retardés</div>
        <small class="text-muted">(11.4%)</small>
      </div>
    </div>
  </div>

  <!-- Graphiques -->
  <div class="row mt-4">
    <div class="col-md-6">
      <div class="card" data-aos="fade-right">
        <div class="card-header">
          <i class="fas fa-chart-line me-2"></i>Évolution de la Régularité (7 jours)
        </div>
        <div class="card-body">
          <div class="chart-container">
            <canvas id="trendChart"></canvas>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card" data-aos="fade-left">
        <div class="card-header">
          <i class="fas fa-chart-pie me-2"></i>Répartition des Retards par Cause
        </div>
        <div class="card-body">
          <div class="chart-container">
            <canvas id="pieChart"></canvas>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Onglets pour les données détaillées -->
  <div class="section-title">Analyse Détaillée</div>
  
  <ul class="nav nav-tabs" id="myTab" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="kpi-tab" data-bs-toggle="tab" data-bs-target="#kpi" type="button" role="tab" aria-controls="kpi" aria-selected="true">
        <i class="fas fa-tachometer-alt me-1"></i> KPI
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="retards-tab" data-bs-toggle="tab" data-bs-target="#retards" type="button" role="tab" aria-controls="retards" aria-selected="false">
        <i class="fas fa-clock me-1"></i> Retards
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="motifs-tab" data-bs-toggle="tab" data-bs-target="#motifs" type="button" role="tab" aria-controls="motifs" aria-selected="false">
        <i class="fas fa-clipboard-list me-1"></i> Motifs
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="tnr-tab" data-bs-toggle="tab" data-bs-target="#tnr" type="button" role="tab" aria-controls="tnr" aria-selected="false">
        <i class="fas fa-subway me-1"></i> TNR
      </button>
    </li>
  </ul>
  
  <div class="tab-content" id="myTabContent">
    <!-- Onglet KPI -->
    <div class="tab-pane fade show active" id="kpi" role="tabpanel" aria-labelledby="kpi-tab">
      <table id="table-kpi" class="table table-striped table-hover" style="width:100%">
        <thead class="table-light">
          <tr>
            <th>Classification</th>
            <th>Trains à circuler</th>
            <th>Trains circulés</th>
            <th>Ponctualité (%)</th>
            <th>Régularité (%)</th>
            <th>Statut</th>
            <th>Commentaire</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Al Atlas</td>
            <td>12</td>
            <td>11</td>
            <td>91.6</td>
            <td>95.0</td>
            <td><span class="badge bg-success">Bon</span></td>
            <td>RAS</td>
          </tr>
          <tr>
            <td>TNR</td>
            <td>25</td>
            <td>25</td>
            <td>87.2</td>
            <td>92.5</td>
            <td><span class="badge bg-warning text-dark">Moyen</span></td>
            <td>Petits retards</td>
          </tr>
          <tr>
            <td>Al Boraq</td>
            <td>18</td>
            <td>18</td>
            <td>94.3</td>
            <td>97.1</td>
            <td><span class="badge bg-success">Excellent</span></td>
            <td>Performance optimale</td>
          </tr>
          <tr>
            <td>Autres</td>
            <td>7</td>
            <td>6</td>
            <td>82.5</td>
            <td>88.3</td>
            <td><span class="badge bg-danger">A améliorer</span></td>
            <td>Plusieurs incidents</td>
          </tr>
          <tr>
  <td>Al Boraq</td>
  <td>10</td>
  <td>10</td>
  <td>98.2</td>
  <td>99.5</td>
  <td><span class="badge bg-success">Excellent</span></td>
  <td>Service à grande vitesse stable</td>
</tr>
<tr>
  <td>Al Atlas</td>
  <td>5</td>
  <td>4</td>
  <td>75.0</td>
  <td>80.0</td>
  <td><span class="badge bg-danger">Faible</span></td>
  <td>Difficultés techniques</td>
</tr>
<tr>
  <td>Al Boraq</td>
  <td>9</td>
  <td>9</td>
  <td>97.8</td>
  <td>99.1</td>
  <td><span class="badge bg-success">Excellent</span></td>
  <td>Rien à signaler</td>
</tr>
<tr>
  <td>TNR </td>
  <td>20</td>
  <td>18</td>
  <td>80.0</td>
  <td>85.0</td>
  <td><span class="badge bg-warning text-dark">Moyen</span></td>
  <td>Densité voyageurs élevée</td>
</tr>
<tr>
  <td>Al Atlas</td>
  <td>14</td>
  <td>13</td>
  <td>88.3</td>
  <td>91.2</td>
  <td><span class="badge bg-success">Bon</span></td>
  <td>Léger retard au départ</td>
</tr>
<tr>
  <td>TNR</td>
  <td>8</td>
  <td>7</td>
  <td>72.5</td>
  <td>79.4</td>
  <td><span class="badge bg-danger">À améliorer</span></td>
  <td>Travaux sur la voie</td>
</tr>
<tr>
  <td>Al Atlas</td>
  <td>6</td>
  <td>6</td>
  <td>95.0</td>
  <td>96.6</td>
  <td><span class="badge bg-success">Très bon</span></td>
  <td>Respect total des horaires</td>
</tr>
<tr>
  <td>Al Boraq</td>
  <td>10</td>
  <td>8</td>
  <td>70.0</td>
  <td>76.5</td>
  <td><span class="badge bg-danger">Critique</span></td>
  <td>Nombreuses interruptions</td>
</tr>
<tr>
  <td>TNR</td>
  <td>5</td>
  <td>5</td>
  <td>90.0</td>
  <td>94.0</td>
  <td><span class="badge bg-success">Excellent</span></td>
  <td>Rien à signaler</td>
</tr>
<tr>
  <td>TNR</td>
  <td>11</td>
  <td>10</td>
  <td>87.5</td>
  <td>90.1</td>
  <td><span class="badge bg-warning text-dark">Moyen</span></td>
  <td>Incident localisé</td>
</tr>
<tr>
  <td>Al Atlas</td>
  <td>7</td>
  <td>6</td>
  <td>82.0</td>
  <td>85.7</td>
  <td><span class="badge bg-warning text-dark">À surveiller</span></td>
  <td>Problèmes climatiques</td>
</tr>
<tr>
  <td>Al Boraq</td>
  <td>4</td>
  <td>4</td>
  <td>100.0</td>
  <td>100.0</td>
  <td><span class="badge bg-success">Parfait</span></td>
  <td>Très bon service</td>
</tr>


        </tbody>
      </table>
    </div>
    
    <!-- Onglet Retards -->
    <div class="tab-pane fade" id="retards" role="tabpanel" aria-labelledby="retards-tab">
      <div class="mb-3">
        <div class="btn-group" role="group">
          <button type="button" class="btn btn-outline-primary filter-btn active" data-filter="all">Tous</button>
          <button type="button" class="btn btn-outline-primary filter-btn" data-filter="Al Atlas">Al Atlas</button>
          <button type="button" class="btn btn-outline-primary filter-btn" data-filter="TNR">TNR</button>
          <button type="button" class="btn btn-outline-primary filter-btn" data-filter="TER">Al Boraq</button>
        </div>
      </div>
      <table id="table-retards" class="table table-striped table-hover" style="width:100%">
        <thead class="table-light">
          <tr>
            <th>Classification</th>
            <th>Train</th>
            <th>Itinéraire</th>
            <th>Départ</th>
            <th>Arrivée</th>
            <th>Retard Départ (min)</th>
            <th>Retard Arrivée (min)</th>
            <th>Statut</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Al Atlas</td>
            <td>A123</td>
            <td>Casablanca - Marrakech</td>
            <td>08:00</td>
            <td>11:30</td>
            <td>20</td>
            <td>18</td>
            <td><span class="badge bg-warning text-dark">Retard moyen</span></td>
          </tr>
          <tr>
            <td>TNR</td>
            <td>T456</td>
            <td>Rabat - Mohammédia</td>
            <td>09:15</td>
            <td>11:45</td>
            <td>10</td>
            <td>12</td>
            <td><span class="badge bg-info">Retard mineur</span></td>
          </tr>
          <tr>
            <td>Al Boraq</td>
            <td>R789</td>
            <td>Kenitra - Rabat</td>
            <td>07:30</td>
            <td>08:15</td>
            <td>5</td>
            <td>3</td>
            <td><span class="badge bg-info">Retard mineur</span></td>
          </tr>
          <tr>
            <td>Al Atlas</td>
            <td>A124</td>
            <td>Marrakech - Tanger</td>
            <td>14:00</td>
            <td>20:30</td>
            <td>35</td>
            <td>30</td>
            <td><span class="badge bg-danger">Retard important</span></td>
          </tr>
          <tr>
  <td>Al Atlas</td>
  <td>R790</td>
  <td>Fès - Meknès</td>
  <td>13:45</td>
  <td>14:30</td>
  <td>7</td>
  <td>6</td>
  <td><span class="badge bg-warning text-dark">Retard moyen</span></td>
</tr>
<tr>
  <td>Al Atlas</td>
  <td>NO401</td>
  <td>Oujda - Nador</td>
  <td>10:00</td>
  <td>12:00</td>
  <td>25</td>
  <td>30</td>
  <td><span class="badge bg-danger">Retard important</span></td>
</tr>
<tr>
  <td>Al Boraq</td>
  <td>BQ999</td>
  <td>Casa Voyageurs - Tanger</td>
  <td>15:00</td>
  <td>17:10</td>
  <td>0</td>
  <td>2</td>
  <td><span class="badge bg-success">A l'heure</span></td>
</tr>
<tr>
  <td>TNR</td>
  <td>TNR07</td>
  <td>Marrakech - Safi</td>
  <td>06:30</td>
  <td>07:40</td>
  <td>12</td>
  <td>10</td>
  <td><span class="badge bg-warning text-dark">Retard moyen</span></td>
</tr>
<tr>
  <td>Al Boraq</td>
  <td>BQ888</td>
  <td>Casa Voyageurs- Tanger</td>
  <td>09:00</td>
  <td>11:00</td>
  <td>2</td>
  <td>3</td>
  <td><span class="badge bg-info">Retard mineur</span></td>
</tr>
<tr>
  <td>TNR Casa-Rabat</td>
  <td>NR001</td>
  <td>Casa - Rabat</td>
  <td>10:45</td>
  <td>12:00</td>
  <td>5</td>
  <td>7</td>
  <td><span class="badge bg-info">Retard mineur</span></td>
</tr>
<tr>
  <td>Al Boraq</td>
  <td>EO900</td>
  <td>Oujda - Nador</td>
  <td>08:00</td>
  <td>10:00</td>
  <td>18</td>
  <td>20</td>
  <td><span class="badge bg-danger">Retard important</span></td>
</tr>
<tr>
  <td>Al Atlas</td>
  <td>NS123</td>
  <td>Fès - Meknès</td>
  <td>06:00</td>
  <td>07:10</td>
  <td>0</td>
  <td>0</td>
  <td><span class="badge bg-success">À l’heure</span></td>
</tr>
<tr>
  <td>TNR</td>
  <td>FR101</td>
  <td>Casablanca - Jorf Lasfar</td>
  <td>03:00</td>
  <td>05:45</td>
  <td>25</td>
  <td>27</td>
  <td><span class="badge bg-danger">Retard critique</span></td>
</tr>
<tr>
  <td>Al Atlas</td>
  <td>MK333</td>
  <td>Meknès - Rabat</td>
  <td>11:00</td>
  <td>12:30</td>
  <td>8</td>
  <td>6</td>
  <td><span class="badge bg-warning text-dark">Retard moyen</span></td>
</tr>
<tr>
  <td>Al Atlas</td>
  <td>AG999</td>
  <td>Agadir - Marrakech</td>
  <td>14:00</td>
  <td>16:15</td>
  <td>20</td>
  <td>18</td>
  <td><span class="badge bg-danger">Retard important</span></td>
</tr>
<tr>
  <td>Al Boraq</td>
  <td>UNI01</td>
  <td>Tanger - Tetouan</td>
  <td>07:00</td>
  <td>08:15</td>
  <td>0</td>
  <td>0</td>
  <td><span class="badge bg-success">À l’heure</span></td>
</tr>
<tr>
  <td>Al Atlas</td>
  <td>TT100</td>
  <td>Tétouan - Tanger</td>
  <td>13:00</td>
  <td>14:20</td>
  <td>3</td>
  <td>2</td>
  <td><span class="badge bg-info">Retard mineur</span></td>
</tr>


        </tbody>
      </table>
    </div>
    
    <!-- Onglet Motifs -->
    <div class="tab-pane fade" id="motifs" role="tabpanel" aria-labelledby="motifs-tab">
      <table id="table-motifs" class="table table-striped table-hover" style="width:100%">
        <thead class="table-light">
          <tr>
            <th>Train</th>
            <th>Classification</th>
            <th>Retard (min)</th>
            <th>Type d'incident</th>
            <th>Description</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>A123</td>
            <td>Al Atlas</td>
            <td>20</td>
            <td>Technique</td>
            <td>Incident technique sur la locomotive</td>
          </tr>
          <tr>
            <td>T456</td>
            <td>TNR</td>
            <td>10</td>
            <td>Infrastructure</td>
            <td>Travaux sur la voie entre Rabat et Kénitra</td>
          </tr>
          <tr>
            <td>A124</td>
            <td>Al Atlas</td>
            <td>35</td>
            <td>Externe</td>
            <td>Passage à niveau bloqué par un véhicule</td>
          </tr>
          <tr>
            <td>R789</td>
            <td>Al Boraq</td>
            <td>5</td>
            <td>Opérationnel</td>
            <td>Retard au départ dû à l'embarquement</td>
          </tr>
          <tr>
  <td>R790</td>
  <td>TNR</td>
  <td>7</td>
  <td>Opérationnel</td>
  <td>Long arrêt intermédiaire imprévu</td>
</tr>
<tr>
  <td>NO401</td>
  <td>Al Atlas</td>
  <td>25</td>
  <td>Infrastructure</td>
  <td>Passage à niveau mal sécurisé</td>
</tr>
<tr>
  <td>BQ999</td>
  <td>Al Boraq</td>
  <td>2</td>
  <td>Autre</td>
  <td>Inspection de sécurité à bord</td>
</tr>
<tr>
  <td>TNR07</td>
  <td>TNR </td>
  <td>12</td>
  <td>Infrastructure</td>
  <td>Détérioration du ballast</td>
</tr>
<tr>
  <td>BQ888</td>
  <td>Al Boraq</td>
  <td>2</td>
  <td>Technique</td>
  <td>Redémarrage système à bord</td>
</tr>
<tr>
  <td>NR001</td>
  <td>Al Atlas</td>
  <td>7</td>
  <td>Opérationnel</td>
  <td>Chargement prolongé des passagers</td>
</tr>
<tr>
  <td>EO900</td>
  <td>TNR</td>
  <td>20</td>
  <td>Infrastructure</td>
  <td>Zone à vitesse réduite</td>
</tr>
<tr>
  <td>FR101</td>
  <td>TNR</td>
  <td>27</td>
  <td>Technique</td>
  <td>Problème moteur sur wagon</td>
</tr>
<tr>
  <td>MK333</td>
  <td>Navette Meknès</td>
  <td>8</td>
  <td>Externe</td>
  <td>Manifestation à proximité de la voie</td>
</tr>
<tr>
  <td>AG999</td>
  <td>Navette Agadir</td>
  <td>20</td>
  <td>Climatique</td>
  <td>Tempête localisée</td>
</tr>
<tr>
  <td>TT100</td>
  <td>Navette Tétouan</td>
  <td>3</td>
  <td>Opérationnel</td>
  <td>Attente correspondance</td>
</tr>
<tr>
  <td>NS123</td>
  <td>Navette Scolaire</td>
  <td>0</td>
  <td>RAS</td>
  <td>Aucun incident signalé</td>
</tr>
<tr>
  <td>UNI01</td>
  <td>Train Universitaire</td>
  <td>0</td>
  <td>RAS</td>
  <td>Fonctionnement optimal</td>
</tr>

        </tbody>
      </table>
    </div>
    
    <!-- Onglet TNR -->
    <div class="tab-pane fade" id="tnr" role="tabpanel" aria-labelledby="tnr-tab">
      <div class="alert alert-info">
        <i class="fas fa-info-circle me-2"></i> Données spécifiques aux Trains Navettes Rapides (TNR)
      </div>
      <table id="table-tnr" class="table table-striped table-hover" style="width:100%">
        <thead class="table-light">
          <tr>
            <th>Train</th>
            <th>Itinéraire</th>
            <th>Heure Départ</th>
            <th>Heure Arrivée</th>
            <th>Retard Départ (min)</th>
            <th>Retard Arrivée (min)</th>
            <th>Statut</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>TNR01</td>
            <td>Casablanca - Rabat</td>
            <td>07:00</td>
            <td>08:15</td>
            <td>5</td>
            <td>7</td>
            <td><span class="badge bg-info">Retard mineur</span></td>
          </tr>
          <tr>
            <td>TNR02</td>
            <td>Rabat - Casablanca</td>
            <td>08:30</td>
            <td>09:45</td>
            <td>0</td>
            <td>3</td>
            <td><span class="badge bg-success">A l'heure</span></td>
          </tr>
          <tr>
            <td>TNR03</td>
            <td>Casablanca - Rabat</td>
            <td>10:00</td>
            <td>11:15</td>
            <td>15</td>
            <td>12</td>
            <td><span class="badge bg-warning text-dark">Retard moyen</span></td>
          </tr>
          <tr>
            <td>TNR04</td>
            <td>Rabat - Casablanca</td>
            <td>12:00</td>
            <td>13:15</td>
            <td>0</td>
            <td>0</td>
            <td><span class="badge bg-success">A l'heure</span></td>
          </tr>
          <tr>
  <td>TNR05</td>
  <td>Kénitra - Casablanca</td>
  <td>14:00</td>
  <td>15:15</td>
  <td>10</td>
  <td>12</td>
  <td><span class="badge bg-warning text-dark">Retard moyen</span></td>
</tr>
<tr>
  <td>TNR06</td>
  <td>Casablanca - Mohammedia</td>
  <td>16:30</td>
  <td>17:00</td>
  <td>0</td>
  <td>0</td>
  <td><span class="badge bg-success">A l'heure</span></td>
</tr>
<tr>
  <td>TNR07</td>
  <td>Mohammedia - Casablanca</td>
  <td>06:45</td>
  <td>07:30</td>
  <td>4</td>
  <td>5</td>
  <td><span class="badge bg-info">Retard mineur</span></td>
</tr>
<tr>
  <td>TNR08</td>
  <td>Casablanca - Kénitra</td>
  <td>08:00</td>
  <td>09:10</td>
  <td>0</td>
  <td>0</td>
  <td><span class="badge bg-success">À l’heure</span></td>
</tr>
<tr>
  <td>TNR09</td>
  <td>Kénitra - Rabat</td>
  <td>10:30</td>
  <td>11:30</td>
  <td>7</td>
  <td>9</td>
  <td><span class="badge bg-warning text-dark">Retard moyen</span></td>
</tr>
<tr>
  <td>TNR10</td>
  <td>Salé - Casablanca</td>
  <td>12:15</td>
  <td>13:30</td>
  <td>2</td>
  <td>3</td>
  <td><span class="badge bg-info">Retard mineur</span></td>
</tr>
<tr>
  <td>TNR11</td>
  <td>Casa - Rabat</td>
  <td>14:00</td>
  <td>15:10</td>
  <td>0</td>
  <td>0</td>
  <td><span class="badge bg-success">À l’heure</span></td>
</tr>
<tr>
  <td>TNR12</td>
  <td>Rabat - Casablanca</td>
  <td>15:00</td>
  <td>16:15</td>
  <td>3</td>
  <td>2</td>
  <td><span class="badge bg-info">Retard mineur</span></td>
</tr>
<tr>
  <td>TNR13</td>
  <td>Mohammedia - Rabat</td>
  <td>17:00</td>
  <td>18:15</td>
  <td>6</td>
  <td>7</td>
  <td><span class="badge bg-warning text-dark">Retard moyen</span></td>
</tr>
<tr>
  <td>TNR14</td>
  <td>Casa - Témara</td>
  <td>18:30</td>
  <td>19:45</td>
  <td>1</td>
  <td>0</td>
  <td><span class="badge bg-success">À l’heure</span></td>
</tr>
<tr>
  <td>TNR15</td>
  <td>Témara - Rabat</td>
  <td>20:00</td>
  <td>21:00</td>
  <td>0</td>
  <td>1</td>
  <td><span class="badge bg-success">À l’heure</span></td>
</tr>
<tr>
  <td>TNR16</td>
  <td>Casa - Rabat</td>
  <td>21:30</td>
  <td>22:45</td>
  <td>4</td>
  <td>5</td>
  <td><span class="badge bg-info">Retard mineur</span></td>
</tr>

        </tbody>
      </table>
    </div>
  </div>

  <!-- Dernière mise à jour -->
  <div class="last-update">
    <i class="fas fa-sync-alt me-1"></i> Dernière mise à jour: <span id="last-update-time"></span>
  </div>

  <!-- Date et heure automatique -->
  <script>
    // Fonction pour formater la date et l'heure
    function updateDateTime() {
      const dateElem = document.getElementById("date-jour");
      const timeElem = document.getElementById("current-time");
      const lastUpdateElem = document.getElementById("last-update-time");
      
      const optionsDate = { year: 'numeric', month: 'long', day: 'numeric' };
      const optionsTime = { hour: '2-digit', minute: '2-digit', second: '2-digit' };
      
      const now = new Date();
      
      dateElem.textContent = now.toLocaleDateString('fr-FR', optionsDate);
      timeElem.textContent = now.toLocaleTimeString('fr-FR', optionsTime);
      lastUpdateElem.textContent = now.toLocaleString('fr-FR', { 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric',
        hour: '2-digit', 
        minute: '2-digit'
      });
    }
    
    // Mettre à jour immédiatement et toutes les minutes
    updateDateTime();
    setInterval(updateDateTime, 60000);
  </script>

  <!-- jQuery + DataTables + Bootstrap JS -->
  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <!-- AOS Animation -->
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <!-- Font Awesome -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>

  <script>
    // Initialisation AOS
    AOS.init({
      duration: 800,
      easing: 'ease-in-out',
      once: true
    });

    // Initialisation DataTables avec options avancées
    $(document).ready(function() {
      // Configuration commune pour toutes les DataTables
      const dataTableOptions = {
        responsive: true,
        dom: 'frt', // Suppression des éléments de pagination et d'info
        language: {
          search: "Rechercher:",
          zeroRecords: "Aucun enregistrement correspondant trouvé"
        }
      };
      
      // Tableau KPI
      $('#table-kpi').DataTable({
        ...dataTableOptions,
        order: [[3, 'desc']] // Tri par ponctualité décroissante
      });
      
      // Tableau Retards
      const retardsTable = $('#table-retards').DataTable({
        ...dataTableOptions,
        order: [[5, 'desc']] // Tri par retard décroissant
      });
      
      // Filtrage des retards par classification
      $('.filter-btn').on('click', function() {
        $('.filter-btn').removeClass('active');
        $(this).addClass('active');
        
        const filter = $(this).data('filter');
        if (filter === 'all') {
          retardsTable.search('').columns().search('').draw();
        } else {
          retardsTable.column(0).search(filter).draw();
        }
      });
      
      // Tableau Motifs
      $('#table-motifs').DataTable({
        ...dataTableOptions,
        order: [[2, 'desc']] // Tri par retard décroissant
      });
      
      // Tableau TNR
      $('#table-tnr').DataTable({
        ...dataTableOptions,
        order: [[4, 'desc']] // Tri par retard décroissant
      });
    });
    
    // Graphique d'évolution
    const trendCtx = document.getElementById('trendChart').getContext('2d');
    const trendChart = new Chart(trendCtx, {
      type: 'line',
      data: {
        labels: ['J-6', 'J-5', 'J-4', 'J-3', 'J-2', 'Hier', 'Aujourd\'hui'],
        datasets: [
          {
            label: 'Ponctualité (%)',
            data: [85.2, 86.7, 88.1, 87.5, 89.0, 88.3, 89.4],
            borderColor: '#006699',
            backgroundColor: 'rgba(0, 102, 153, 0.1)',
            borderWidth: 2,
            tension: 0.3,
            fill: true
          },
          {
            label: 'Régularité (%)',
            data: [90.1, 91.3, 91.8, 92.0, 92.4, 92.1, 92.5],
            borderColor: '#28a745',
            backgroundColor: 'rgba(40, 167, 69, 0.1)',
            borderWidth: 2,
            tension: 0.3,
            fill: true
          }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: 'top',
          },
          tooltip: {
            mode: 'index',
            intersect: false,
          }
        },
        scales: {
          y: {
            beginAtZero: false,
            min: 80,
            max: 100,
            ticks: {
              callback: function(value) {
                return value + '%';
              }
            }
          }
        }
      }
    });
    
    // Graphique circulaire
    const pieCtx = document.getElementById('pieChart').getContext('2d');
    const pieChart = new Chart(pieCtx, {
      type: 'pie',
      data: {
        labels: ['Technique', 'Infrastructure', 'Opérationnel', 'Externe', 'Autre'],
        datasets: [{
          data: [35, 25, 20, 15, 5],
          backgroundColor: [
            '#006699',
            '#28a745',
            '#ffc107',
            '#dc3545',
            '#6c757d'
          ],
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: 'right',
          },
          tooltip: {
            callbacks: {
              label: function(context) {
                const label = context.label || '';
                const value = context.raw || 0;
                const total = context.dataset.data.reduce((a, b) => a + b, 0);
                const percentage = Math.round((value / total) * 100);
                return `${label}: ${value} (${percentage}%)`;
              }
            }
          }
        }
      }
    });
  </script>
</body>
</html>
