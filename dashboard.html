<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Dashboard de Régularité des Trains | ONCF</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Tableau de bord interactif de la régularité des trains ONCF">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
  <style>
    :root {
      --primary-color: #006699;
      --secondary-color: #e9ecef;
      --success-color: #28a745;
      --warning-color: #ffc107;
      --danger-color: #dc3545;
    }
    body { padding: 20px; font-family: 'Segoe UI', 'Roboto', sans-serif; background-color: #f8fafc; color: #333; }
    .logo-container { display: flex; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid #eee; }
    .header-content { margin-left: 20px; }
    .logo { height: 70px; transition: transform 0.3s; }
    .logo:hover { transform: scale(1.05); }
    .header-title { color: var(--primary-color); margin-bottom: 0; font-weight: 700; }
    .header-subtitle { color: #6c757d; margin-top: 5px; }
    .section-title { font-size: 1.5rem; margin-top: 40px; margin-bottom: 20px; color: var(--primary-color); font-weight: 600; padding-bottom: 8px; border-bottom: 2px solid var(--primary-color);}
    .card { border-radius: 10px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); margin-bottom: 20px; border: none; transition: transform 0.3s, box-shadow 0.3s;}
    .card:hover { transform: translateY(-5px); box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);}
    .card-header { background-color: var(--primary-color); color: white; font-weight: 600; border-radius: 10px 10px 0 0 !important;}
    .kpi-card { text-align: center; padding: 15px;}
    .kpi-value { font-size: 2.5rem; font-weight: 700;}
    .kpi-label { font-size: 1rem; color: #6c757d;}
    .positive { color: var(--success-color);}
    .negative { color: var(--danger-color);}
    .neutral { color: var(--warning-color);}
    .table th { background-color: var(--secondary-color); font-weight: 600; }
    .badge-custom { padding: 5px 10px; border-radius: 20px; font-weight: 500;}
    .tab-content { padding: 20px; background: white; border: 1px solid #dee2e6; border-top: none; border-radius: 0 0 10px 10px;}
    .nav-tabs .nav-link { font-weight: 500;}
    .nav-tabs .nav-link.active { font-weight: 600;}
    .dataTables_filter input { border-radius: 20px; padding: 5px 15px; border: 1px solid #ced4da;}
    .progress { height: 10px; border-radius: 5px;}
    .progress-bar { background-color: var(--primary-color);}
    .chart-container { position: relative; height: 300px; margin-bottom: 30px;}
    .last-update { font-size: 0.8rem; color: #6c757d; text-align: right; margin-top: 20px;}
    @media (max-width: 768px) { .logo-container { flex-direction: column; text-align: center; } .header-content { margin-left: 0; margin-top: 10px; } .kpi-card { margin-bottom: 15px; }}
  </style>
</head>

<body>
  <!-- En-tête avec logo -->
  <div class="logo-container">
    <img src="LOGO.jpg" alt="Logo ONCF" class="logo">
    <div class="header-content">
      <h1 class="header-title">Dashboard de Régularité des Trains</h1>
      <p class="header-subtitle">Données du <span id="date-jour"></span> <span id="current-time"></span></p>
    </div>
  </div>

  <!-- Section KPI Principaux -->
  <div class="section-title">Indicateurs Clés de Performance</div>
  <div class="row">
    <div class="col-md-3">
      <div class="card kpi-card" data-aos="fade-up">
        <div class="kpi-value positive" id="reg-globale"></div>
        <div class="kpi-label">Régularité Globale</div>
        <div class="progress mt-2">
          <div class="progress-bar" id="reg-globale-bar" role="progressbar" style="width:0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card kpi-card" data-aos="fade-up" data-aos-delay="100">
        <div class="kpi-value neutral" id="ponc-globale"></div>
        <div class="kpi-label">Ponctualité Globale</div>
        <div class="progress mt-2">
          <div class="progress-bar" id="ponc-globale-bar" role="progressbar" style="width:0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card kpi-card" data-aos="fade-up" data-aos-delay="200">
        <div class="kpi-value" id="trains-programmes"></div>
        <div class="kpi-label">Trains Programmes</div>
        <small class="text-muted" id="trains-circules"></small>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card kpi-card" data-aos="fade-up" data-aos-delay="300">
        <div class="kpi-value negative" id="trains-retardes"></div>
        <div class="kpi-label">Trains Retardés</div>
        <small class="text-muted" id="pourcentage-retardes"></small>
      </div>
    </div>
  </div>

  <!-- Graphiques -->
  <div class="row mt-4">
    <div class="col-md-6">
      <div class="card" data-aos="fade-right">
        <div class="card-header">
          <i class="fas fa-chart-line me-2"></i>Évolution de la Régularité (7 jours)
        </div>
        <div class="card-body">
          <div class="chart-container">
            <canvas id="trendChart"></canvas>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card" data-aos="fade-left">
        <div class="card-header">
          <i class="fas fa-chart-pie me-2"></i>Répartition des Retards par Cause
        </div>
        <div class="card-body">
          <div class="chart-container">
            <canvas id="pieChart"></canvas>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Onglets pour les données détaillées -->
  <div class="section-title">Analyse Détaillee</div>
  
  <ul class="nav nav-tabs" id="myTab" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="kpi-tab" data-bs-toggle="tab" data-bs-target="#kpi" type="button" role="tab" aria-controls="kpi" aria-selected="true">
        <i class="fas fa-tachometer-alt me-1"></i> KPI
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="retards-tab" data-bs-toggle="tab" data-bs-target="#retards" type="button" role="tab" aria-controls="retards" aria-selected="false">
        <i class="fas fa-clock me-1"></i> Retards
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="tnr-tab" data-bs-toggle="tab" data-bs-target="#tnr" type="button" role="tab" aria-controls="tnr" aria-selected="false">
        <i class="fas fa-subway me-1"></i> TNR
      </button>
    </li>
  </ul>
  
  <div class="tab-content" id="myTabContent">
    <!-- Onglet KPI -->
    <div class="tab-pane fade show active" id="kpi" role="tabpanel" aria-labelledby="kpi-tab">
      <table id="table-kpi" class="table table-striped table-hover" style="width:100%">
        <thead class="table-light">
          <tr>
            <th>Classification</th>
            <th>Trains à circuler</th>
            <th>Trains circulés</th>
            <th>Ponctualité (%)</th>
            <th>Régularité (%)</th>
            <th>Statut</th>
            <th>Commentaire</th>
          </tr>
        </thead>
        <tbody id="tbody-kpi"></tbody>
      </table>
    </div>
    
    <!-- Onglet Retards -->
    <div class="tab-pane fade" id="retards" role="tabpanel" aria-labelledby="retards-tab">
      <table id="table-retards" class="table table-striped table-hover" style="width:100%">
        <thead class="table-light">
          <tr>
            <th>Classification</th>
            <th>Train</th>
            <th>Retard Départ (min)</th>
            <th>Retard Arrivée (min)</th>
            <th>Motif</th>
          </tr>
        </thead>
        <tbody id="tbody-retards"></tbody>
      </table>
    </div>
    
    <!-- Onglet TNR -->
    <div class="tab-pane fade" id="tnr" role="tabpanel" aria-labelledby="tnr-tab">
      <table id="table-tnr" class="table table-striped table-hover" style="width:100%">
        <thead class="table-light">
          <tr>
            <th>Train</th>
            <th>Retard Départ (min)</th>
            <th>Retard Arrivée (min)</th>
          </tr>
        </thead>
        <tbody id="tbody-tnr"></tbody>
      </table>
    </div>
  </div>

  <!-- Dernière mise à jour -->
  <div class="last-update">
    <i class="fas fa-sync-alt me-1"></i> Dernière mise à jour: <span id="last-update-time"></span>
  </div>

  <!-- Date et heure automatique -->
  <script>
  // Initialisation AOS
  AOS.init({ duration: 800, easing: 'ease-in-out', once: true });

  // Charger les données dynamiques du fichier JSON
  fetch('data.json')
    .then(response => {
      if (!response.ok) {
        throw new Error('Network response was not ok');
      }
      return response.json();
    })
    .then(data => {
      // Indicateurs principaux
      document.getElementById('reg-globale').textContent = data.regulariteGlobale ? data.regulariteGlobale + "%" : "--";
      document.getElementById('reg-globale-bar').style.width = (data.regulariteGlobale || 0) + "%";
      document.getElementById('reg-globale-bar').setAttribute('aria-valuenow', data.regulariteGlobale || 0);

      document.getElementById('ponc-globale').textContent = data.ponctualiteGlobale ? data.ponctualiteGlobale + "%" : "--";
      document.getElementById('ponc-globale-bar').style.width = (data.ponctualiteGlobale || 0) + "%";
      document.getElementById('ponc-globale-bar').setAttribute('aria-valuenow', data.ponctualiteGlobale || 0);

      document.getElementById('trains-programmes').textContent = data.trainsProgrammes ?? "--";
      document.getElementById('trains-circules').textContent = "Circulés : " + (data.trainsCircules ?? "--");

      document.getElementById('trains-retardes').textContent = data.trainsRetardes ?? "--";
      let pourcentageRetardes = data.trainsCircules ? ((data.trainsRetardes / data.trainsCircules) * 100).toFixed(1) : "--";
      document.getElementById('pourcentage-retardes').textContent = "Retardés : " + pourcentageRetardes + "%";

      // (Tu peux ajouter l'affichage des autres indicateurs ici)

      // Exemple de remplissage du tableau KPI si tu as data.kpi (array)
      if (Array.isArray(data.kpi)) {
        let tbodyKPI = document.getElementById('tbody-kpi');
        tbodyKPI.innerHTML = "";
        data.kpi.forEach(row => {
          let tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${row.classification}</td>
            <td>${row.trainsACirculer}</td>
            <td>${row.trainsCircules}</td>
            <td>${row.ponctualite}</td>
            <td>${row.regularite}</td>
            <td>${row.statut}</td>
            <td>${row.commentaire ?? ""}</td>
          `;
          tbodyKPI.appendChild(tr);
        });
      }

      // Pareil pour les autres onglets si tu as les données (retards, tnr)
      // ... (ajoute ici le code pour remplir les autres tableaux)
    })
    .catch(error => {
      console.error('Erreur lors du chargement de data.json:', error);
      alert('Erreur de chargement des données du dashboard : ' + error.message);
    });
</script>
</body>

</html>


